<script>
let time = 600;
let level = 0;
let score = 0;
let correctCount = 0;
let wrongCount = 0;
let timerInt;
let locked = false;
let selected = [];

const TOTAL_QUESTIONS = 15;

const levels = [

  // 1‚Äì8 (2 images)
  {type:"img", q:"Find the fake image", correct:[1]}, // L1
  {type:"img", q:"Find the fake image", correct:[1]}, // L2
  {type:"img", q:"Find the fake image", correct:[0]}, // L3
  {type:"img", q:"Find the fake image", correct:[1]}, // L4
  {type:"img", q:"Find the fake image", correct:[0]}, // L5
  {type:"img", q:"Find the fake image", correct:[0]}, // L6
  {type:"img", q:"Find the fake image", correct:[1]}, // L7
  {type:"img", q:"Find the fake image", correct:[0]}, // L8

  // 9‚Äì13 (3 images)
  {type:"img", q:"Find the two fake images", correct:[0,2]}, // L9
  {type:"img", q:"Find the two fake images", correct:[0,1]}, // L10
  {type:"img", q:"Find the two fake images", correct:[1,2]}, // L11
  {type:"img", q:"Find the two fake images", correct:[1,2]}, // L12
  {type:"img", q:"Find the two fake images", correct:[0,1]}, // L13

  // 14‚Äì15 (2 videos)
  {type:"vid", q:"Identify the ORIGINAL video", correct:[1]}, // L14
  {type:"vid", q:"Identify the ORIGINAL video", correct:[1]}  // L15
];

function startGame(){
  document.getElementById("start").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  startTimer();
  loadLevel();
}

function startTimer(){
  timerInt = setInterval(()=>{
    time--;
    let m = Math.floor(time/60);
    let s = time % 60;
    document.getElementById("timer").innerText =
      `Time Left: ${m}:${s<10?"0"+s:s}`;
    if(time <= 0) endGame();
  },1000);
}

function loadLevel(){
  locked = false;
  selected = [];
  document.getElementById("feedback").innerText = "";
  document.getElementById("okBtn").classList.add("hidden");

  const media = document.getElementById("media");
  media.innerHTML = "";

  document.getElementById("levelText").innerText =
    `QUESTION ${level+1} / 15`;
  document.getElementById("question").innerText =
    levels[level].q;

  if(levels[level].type === "img"){

    // Levels 1‚Äì8 ‚Üí 2 images
    // Levels 9‚Äì13 ‚Üí 3 images
    let count = (level < 8) ? 2 : 3;

    for(let i=0;i<count;i++){
      let img = document.createElement("img");
      img.src = `level${level+1}_${i+1}.jpg`;
      img.onclick = ()=>selectAnswer(i);
      media.appendChild(img);
    }

  } else {

    // Videos always 2
    for(let i=0;i<2;i++){
      let v = document.createElement("video");
      v.src = `video${level-12}_${i+1}.mp4`;
      v.muted = true;
      v.loop = true;
      v.autoplay = true;
      v.onclick = ()=>selectAnswer(i);
      media.appendChild(v);
    }
  }
}

function selectAnswer(index){
  if(locked) return;

  const requiredSelections = levels[level].correct.length;
  const items = Array.from(document.getElementById("media").children);

  if(selected.includes(index)) return;

  selected.push(index);
  items[index].style.borderColor = "#00e5ff";

  if(selected.length === requiredSelections){
    locked = true;

    const correctSorted = [...levels[level].correct].sort().toString();
    const selectedSorted = [...selected].sort().toString();

    items.forEach((el,i)=>{
      el.style.pointerEvents="none";
      if(levels[level].correct.includes(i)){
        el.style.borderColor="#00ff99";
      }
    });

    if(correctSorted === selectedSorted){
      score++;
      correctCount++;
      document.getElementById("feedback").innerText="‚úÖ Correct Answer";
      document.getElementById("feedback").style.color="#00ff99";
    } else {
      selected.forEach(i=>{
        if(!levels[level].correct.includes(i)){
          items[i].style.borderColor="#ff5252";
        }
      });
      wrongCount++;
      document.getElementById("feedback").innerText="‚ùå Wrong Answer";
      document.getElementById("feedback").style.color="#ff5252";
    }

    document.getElementById("okBtn").classList.remove("hidden");
  }
}

function confirmAnswer(){
  level++;
  if(level < TOTAL_QUESTIONS){
    loadLevel();
  } else {
    endGame();
  }
}

function endGame(){
  clearInterval(timerInt);
  document.getElementById("game").classList.add("hidden");
  document.getElementById("final").classList.remove("hidden");

  let accuracy = Math.round((score / TOTAL_QUESTIONS) * 100);
  let brain = "";

  if(accuracy >= 90) brain = "üß† ELITE FORENSIC BRAIN";
  else if(accuracy >= 80) brain = "üî• ADVANCED ANALYST";
  else if(accuracy >= 70) brain = "‚ö° SKILLED INVESTIGATOR";
  else if(accuracy >= 60) brain = "‚úÖ GOOD OBSERVER";
  else brain = "üß™ NEEDS TRAINING";

  document.getElementById("result").innerHTML = `
    <h3>Final Score: ${score} / 15</h3>
    <p>Correct: ${correctCount}</p>
    <p>Wrong: ${wrongCount}</p>
    <p>Accuracy: ${accuracy}%</p>
    <h2>${brain}</h2>
  `;
}
</script>
